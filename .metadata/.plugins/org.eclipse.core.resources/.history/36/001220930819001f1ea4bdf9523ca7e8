package in.microsoft.controller;

import java.sql.SQLException;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.ModelAndView;

import in.microsoft.dao.ProductDAO;
import in.microsoft.pojos.Cart;
import in.microsoft.pojos.Product;

@Controller
public class CustomerController 
{
	private ProductDAO pdao = new ProductDAO();
	
	@RequestMapping("/addProductsToCart")
	public ModelAndView addProductsToCart()
	{
		ModelAndView mv = new ModelAndView();
		mv.setViewName("add_products_to_cart.jsp");
		System.out.println("Adding Product(s)");
		return mv;
	}
	
	@RequestMapping("/getProductsToCart")
	public ModelAndView getProductsToCart(HttpServletRequest request, HttpServletResponse response) throws SQLException, ClassNotFoundException
	{
		ModelAndView mv = new ModelAndView();
		String pro_name = request.getParameter("pro_name");
		String name = request.getParameter("name");
		int pro_quantity = Integer.parseInt(request.getParameter("pro_quantity"));
		int quantity = Integer.parseInt(request.getParameter("quantity"));
		
		if(name.equalsIgnoreCase(pro_name))
		{
			System.out.println("Adding Products In Cart");
			Cart cart = new Cart(name, quantity);
			pdao.addProductsToCart(cart);
			mv.setViewName("add_products_to_cart_success.jsp");	
		}
		else 
		{
			mv.setViewName("product_availability_error.jsp");
			mv.addObject("errorMessage", "Product '" + name + "' and '" + quantity + "'is not available.");
		}
		return mv;
	}
	
	@RequestMapping("/removeProductsFromCart")
	public ModelAndView removeProducts() 
	{
		ModelAndView mv = new ModelAndView();
		mv.setViewName("remove_products_from_cart.jsp");
		System.out.println("Removing Product(s)");	
		return mv;
	}
	
	@RequestMapping("/deleteProduct")
	public ModelAndView deleteProduct(HttpServletRequest request, HttpServletResponse response) throws ClassNotFoundException, SQLException {
		ModelAndView mv = new ModelAndView();
		String name = request.getParameter("productName");
		System.out.println("Getting Product Remove");
		pdao.removeProducts(name);
		mv.setViewName("remove_product_from_cart_success.jsp");
		return mv;
	}
	
	@RequestMapping("/displayProductsFromCart")
	public ModelAndView showProductsToCart() throws SQLException, ClassNotFoundException
	{
		ModelAndView mv = new ModelAndView();
		List<Cart> list = pdao.showProductsToCart();
		for (Cart cart: list) 
			{ 
				System.out.println(cart.toString());
			}
		mv.setViewName("display_product_from_cart.jsp");
		mv.addObject("list", list);
		System.out.println("Showing all Products In Cart");
		return mv;
	}

	@RequestMapping("/displayProductsToCustomer")
	public ModelAndView showProducts() throws SQLException, ClassNotFoundException
	{
		ModelAndView mv = new ModelAndView();
		List<Product> list = pdao.showProducts();
		for (Product pro: list) 
			{ 
				System.out.println(pro.toString());
			}
		mv.setViewName("display_product.jsp");
		mv.addObject("list", list);
		System.out.println("Showing all Products");
		return mv;
	}
	
	@RequestMapping("/displayBill")
    public ModelAndView displayBill() throws SQLException, ClassNotFoundException {
        ModelAndView mv = new ModelAndView();
        List<Cart> cartItems = pdao.showProductsToCart();
        List<Product> billItems = pdao.getProductsToCart(cartItems);
        mv.setViewName("display_bill.jsp");
        mv.addObject("list", billItems);
        return mv;
    }
}
